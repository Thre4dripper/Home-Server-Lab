# ==============================================
# SAMBA SERVER CONFIGURATION
# ==============================================
# This file configures the Samba shares and access
# Modify this file to add/remove shares and configure access

[global]
    # Server identification
    workgroup = WORKGROUP
    server string = Raspberry Pi Samba Server
    netbios name = PISERVER
    
    # Security settings
    security = user
    map to guest = Bad User
    guest account = nobody
    
    # SMB Protocol - macOS Sonoma+ requires SMB2/3
    server min protocol = SMB2
    server max protocol = SMB3
    
    # macOS compatibility - CRITICAL for Mac connections
    server signing = auto
    client signing = auto
    
    # Performance tuning
    socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBUF=65536 SO_SNDBUF=65536
    read raw = yes
    write raw = yes
    max xmit = 65535
    dead time = 15
    getwd cache = yes
    
    # Logging
    log file = /var/log/samba/log.%m
    max log size = 50
    log level = 1
    
    # Disable printing (not needed for file sharing)
    load printers = no
    printing = bsd
    printcap name = /dev/null
    disable spoolss = yes
    
    # Apple/Mac compatibility (Fruit VFS for Time Machine, etc.)
    vfs objects = fruit streams_xattr
    fruit:metadata = stream
    fruit:model = MacSamba
    fruit:posix_rename = yes
    fruit:veto_appledouble = no
    fruit:nfs_aces = no
    fruit:wipe_intentionally_left_blank_rfork = yes
    fruit:delete_empty_adfiles = yes
    
    # Bonjour/Avahi advertisement for Mac discovery
    multicast dns register = yes

# ==============================================
# SHARE DEFINITIONS
# ==============================================

# ----------------------------------------------
# Public Share (Guest Access)
# ----------------------------------------------
[Public]
    comment = Public Share - Guest Access
    path = /shares/public
    browseable = yes
    read only = no
    guest ok = yes
    create mask = 0775
    directory mask = 0775
    force user = nobody
    force group = nogroup

# ----------------------------------------------
# Media Share (Read-Only for Guests)
# ----------------------------------------------
[Media]
    comment = Media Files - Movies, Music, Photos
    path = /shares/media
    browseable = yes
    read only = yes
    guest ok = yes
    # Authenticated users can write (add usernames separated by space)
    write list = pi
    create mask = 0775
    directory mask = 0775

# ----------------------------------------------
# Documents Share (Authenticated Only)
# ----------------------------------------------
[Documents]
    comment = Personal Documents - Authenticated Users Only
    path = /shares/documents
    browseable = yes
    read only = no
    guest ok = no
    # Add usernames separated by space (e.g., pi admin john)
    valid users = pi
    create mask = 0770
    directory mask = 0770

# ==============================================
# ADDING CUSTOM SHARES
# ==============================================
# To add a new share:
# 1. Add a volume mount in docker-compose.yml
# 2. Copy this template and modify:
#
# [ShareName]
#     comment = Description of share
#     path = /shares/sharename
#     browseable = yes
#     read only = no
#     guest ok = no
#     valid users = @users
#     create mask = 0770
#     directory mask = 0770
